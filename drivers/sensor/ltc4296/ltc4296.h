/*
 * Copyright (c) 2024 Analog Devices Inc.
 *
 * SPDX-License-Identifier: Apache-2.0
 */

#ifndef ZEPHYR_DRIVERS_SENSOR_LTC4296_LTC4296_H_
#define ZEPHYR_DRIVERS_SENSOR_LTC4296_LTC4296_H_

#include <zephyr/kernel.h>
#include <zephyr/types.h>
#include <zephyr/device.h>
#include <zephyr/drivers/gpio.h>
#include <zephyr/drivers/sensor.h>
#include <zephyr/drivers/spi.h>

/*
 * LTC4296 registers definition
 */

#define LTC4296_REG_GFLTEV        	0x02
#define LTC4296_REG_GFLTMSK       	0x03
#define LTC4296_REG_GCAP          	0x06
#define LTC4296_REG_GIOST         	0x07
#define LTC4296_REG_GCMD          	0x08
#define LTC4296_REG_GCFG          	0x09
#define LTC4296_REG_GADCCFG       	0x0A
#define LTC4296_REG_GADCDAT       	0x0B
#define LTC4296_REG_P0EV          	0x10
#define LTC4296_REG_P0ST          	0x12
#define LTC4296_REG_P0CFG0        	0x13
#define LTC4296_REG_P0CFG1        	0x14
#define LTC4296_REG_P0ADCCFG      	0x15
#define LTC4296_REG_P0ADCDAT      	0x16
#define LTC4296_REG_P0SELFTEST    	0x17
#define LTC4296_REG_P1EV          	0x20
#define LTC4296_REG_P1ST          	0x22
#define LTC4296_REG_P1CFG0        	0x23
#define LTC4296_REG_P1CFG1        	0x24
#define LTC4296_REG_P1ADCCFG      	0x25
#define LTC4296_REG_P1ADCDAT      	0x26
#define LTC4296_REG_P1SELFTEST    	0x27
#define LTC4296_REG_P2EV          	0x30
#define LTC4296_REG_P2ST          	0x32
#define LTC4296_REG_P2CFG0        	0x33
#define LTC4296_REG_P2CFG1       	0x34
#define LTC4296_REG_P2ADCCFG      	0x35
#define LTC4296_REG_P2ADCDAT      	0x36
#define LTC4296_REG_P2SELFTEST   	0x37
#define LTC4296_REG_P3EV          	0x40
#define LTC4296_REG_P3ST          	0x42
#define LTC4296_REG_P3CFG0        	0x43
#define LTC4296_REG_P3CFG1        	0x44
#define LTC4296_REG_P3ADCCFG      	0x45
#define LTC4296_REG_P3ADCDAT     	0x46
#define LTC4296_REG_P3SELFTEST    	0x47
#define LTC4296_REG_P4EV          	0x50
#define LTC4296_REG_P4ST          	0x52
#define LTC4296_REG_P4CFG0        	0x53
#define LTC4296_REG_P4CFG1      	0x54
#define LTC4296_REG_P4ADCCFG      	0x55
#define LTC4296_REG_P4ADCDAT     	0x56
#define LTC4296_REG_P4SELFTEST    	0x57

/* LTC4296_REG_GFLTEV */
#define LTC4296_UVLO_DIGITAL_MSK	BIT(4)
#define LTC4296_COMMAND_FAULT_MSK	BIT(3)
#define LTC4296_PEC_FAULT_MSK		BIT(2)
#define LTC4296_MEMORY_FAULT_MSK	BIT(1)
#define LTC4296_LOW_CKT_BRK_FAULT_MSK	BIT(0)

/* LTC4296_REG_GCAP */
#define LTC4296_SCCP_SUPPORT_MSK             BIT(6)
#define LTC4296_WAKE_FWD_SUPPORT_MSK         BIT(5)
#define LTC4296_NUMPORTS_MSK                 GENMASK(4, 0)

/* LTC4296_REG_GIOST */
#define LTC4296_PG_OUT4_MSK			BIT(8)
#define LTC4296_PG_OUT3_MSK			BIT(7)
#define LTC4296_PG_OUT2_MSK			BIT(6)
#define LTC4296_PG_OUT1_MSK			BIT(5)
#define LTC4296_PG_OUT0_MSK			BIT(4)
#define LTC4296_PAD_AUTO_MSK			BIT(3)
#define LTC4296_PAD_WAKEUP_MSK			BIT(2)
#define LTC4296_PAD_WAKEUP_DRIVE_MSK		BIT(1)

/* LTC4296_REG_GCMD */
#define LTC4296_SW_RESET_MSK			GENMASK(15, 8)
#define LTC4296_WRITE_PROTECT_MSK		GENMASK(7, 0)

/* LTC4296_REG_GCFG */
#define LTC4296_MASK_LOWFAULT_MSK		BIT(5)
#define LTC4296_TLIM_DISABLE_MSK		BIT(4)
#define LTC4296_TLIM_TIMER_SLEEP_MSK		GENMASK(3, 2)
#define LTC4296_REFRESH_MSK			BIT(1)
#define LTC4296_SW_VIN_PGOOD_MSK		BIT(0)

/* LTC4296_REG_GADCCFG */
#define LTC4296_GADC_SAMPLE_MODE_MSK		GENMASK(6, 5)
#define LTC4296_GADC_SEL_MSK			GENMASK(4, 0)

/* LTC4296_REG_GADCDAT */
#define LTC4296_GADC_MISSED_MSK			BIT(13)
#define LTC4296_GADC_NEW_MSK			BIT(12)
#define LTC4296_GADC_MSK			GENMASK(11, 0)

/* LTC4296_REG_PXEV */
#define LTC4296_VALID_SIGNATURE_MSK		BIT(9)
#define LTC4296_INVALID_SIGNATURE_MSK		BIT(8)
#define LTC4296_TOFF_TIMER_DONE_MSK		BIT(7)
#define LTC4296_OVERLOAD_DETECTED_ISLEEP_MSK	BIT(6)
#define LTC4296_OVERLOAD_DETECTED_IPOWERED_MSK	BIT(5)
#define LTC4296_MFVS_TIMEOUT_MSK		BIT(4)
#define LTC4296_TINRUSH_TIMER_DONE_MSK		BIT(3)
#define LTC4296_PD_WAKEUP_MSK			BIT(2)
#define LTC4296_LSNS_FORWARD_FAULT_MSK		BIT(1)
#define LTC4296_LSNS_REVERSE_FAULT_MSK		BIT(0)

/* LTC4296_REG_PXST */
#define LTC4296_DET_VHIGH_MSK			BIT(13)
#define LTC4296_DET_VLOW_MSK			BIT(12)
#define LTC4296_POWER_STABLE_HI_MSK		BIT(11)
#define LTC4296_POWER_STABLE_LO_MSK		BIT(10)
#define LTC4296_POWER_STABLE_MSK		BIT(9)
#define LTC4296_OVERLOAD_HELD_MSK		BIT(8)
#define LTC4296_PI_SLEEPING_MSK			BIT(7)
#define LTC4296_PI_PREBIASED_MSK		BIT(6)
#define LTC4296_PI_DETECTING_MSK		BIT(5)
#define LTC4296_PI_POWERED_MSK			BIT(4)
#define LTC4296_PI_DISCHARGE_EN_MSK		BIT(3)
#define LTC4296_PSE_STATUS_MSK			GENMASK(2, 0)

/* LTC4296_REG_PXCFG0 */
#define LTC4296_SW_INRUSH_MSK			BIT(15)
#define LTC4296_END_CLASSIFICATION_MSK		BIT(14)
#define LTC4296_SET_CLASSIFICATION_MODE_MSK	BIT(13)
#define LTC4296_DISABLE_DETECTION_PULLUP_MSK	BIT(12)
#define LTC4296_TDET_DISABLE_MSK		BIT(11)
#define LTC4296_FOLDBACK_DISABLE_MSK		BIT(10)
#define LTC4296_SOFT_START_DISABLE_MSK		BIT(9)
#define LTC4296_TOFF_TIMER_DISABLE_MSK		BIT(8)
#define LTC4296_TMFVDO_TIMER_DISABLE_MSK	BIT(7)
#define LTC4296_SW_PSE_READY_MSK		BIT(6)
#define LTC4296_SW_POWER_AVAILABLE_MSK		BIT(5)
#define LTC4296_UPSTREAM_WAKEUP_DISABLE_MSK	BIT(4)
#define LTC4296_DOWNSTREAM_WAKEUP_DISABLE_MSK	BIT(3)
#define LTC4296_SW_PSE_WAKEUP_MSK		BIT(2)
#define LTC4296_HW_EN_MASK_MSK			BIT(1)
#define LTC4296_SW_EN_MSK			BIT(0)

/* LTC4296_REG_PXCFG1 */
#define LTC4296_PREBIAS_OVERRIDE_GOOD_MSK	BIT(8)
#define LTC4296_TLIM_TIMER_TOP_MSK		GENMASK(7, 6)
#define LTC4296_TOD_TRESTART_TIMER_MSK		GENMASK(5, 4)
#define LTC4296_TINRUSH_TIMER_MSK		GENMASK(3, 2)
#define LTC4296_SIG_OVERRIDE_BAD_MSK		BIT(1)
#define LTC4296_SIG_OVERRIDE_GOOD_MSK		BIT(0)

/* LTC4296_REG_PXADCCFG */
#define LTC4296_MFVS_THRESHOLD_MSK		GENMASK(7, 0)

/* LTC4296_REG_PXADCDAT */
#define LTC4296_MISSED_MSK			BIT(13)
#define LTC4296_NEW_MSK				BIT(12)
#define LTC4296_SOURCE_CURRENT_MSK		GENMASK(11, 0)

/* Miscellaneous Definitions*/
#define LTC4296_RESET_CODE			0x73
#define LTC4296_UNLOCK_KEY			0x05
#define LTC4296_LOCK_KEY			0xA0

#define LTC4296_VGAIN				35230 / 1000
#define LTC4296_IGAIN				1 / 10

#define LTC4296_VMAX         			1
#define LTC4296_VMIN        			0

#define LTC4296_MAX_PORTS			5

#define RTESTLOAD              			200 /*(ohm)*/

struct ltc4296_data {
	uint16_t sample;
	uint8_t current_sccp_port;
};

struct ltc4296_port_config {
	struct gpio_dt_spec sccpo_gpio;
	struct gpio_dt_spec sccpi_gpio;
	uint8_t power_class;
	uint32_t hs_resistor;
};

struct ltc4296_dev_config {
	struct spi_dt_spec bus;
	struct ltc4296_port_config port_config[LTC4296_MAX_PORTS];
};

#endif /* ZEPHYR_DRIVERS_SENSOR_LTC4296_LTC4296_H_ */
